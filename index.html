<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Apple Music Style Player</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    background: #fff;
    color: #000;
    margin: 0;
    padding: 20px;
  }
  .player {
    max-width: 400px;
    margin: 0 auto;
  }
  .artwork {
    width: 100%;
    border-radius: 8px;
    margin-bottom: 15px;
  }
  .song-title {
    font-weight: 600;
    font-size: 1.2rem;
    margin-bottom: 4px;
  }
  .artist-name {
    font-weight: 400;
    color: #666;
    margin-bottom: 15px;
  }
  audio {
    width: 100%;
    outline: none;
  }
  ul.song-list {
    list-style: none;
    padding: 0;
    margin-top: 30px;
    max-height: 300px;
    overflow-y: auto;
  }
  ul.song-list li {
    padding: 10px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
  }
  ul.song-list li:hover {
    background: #f0f0f0;
  }
  ul.song-list li.active {
    background: #e0e0e0;
    font-weight: 600;
  }
</style>
</head>
<body>
<div class="player">
  <img id="artwork" class="artwork" src="" alt="Artwork" />
  <div class="song-title" id="title">Loading...</div>
  <div class="artist-name" id="artist"></div>
  <audio id="audio" controls></audio>
  <ul id="songList" class="song-list"></ul>
</div>

<script>
  const JSON_URL = 'https://raw.githubusercontent.com/bobobo1343/APPLEMUSICSONGSJSON/refs/heads/main/songs.json';
  const FALLBACK_ARTWORK = 'https://is3-ssl.mzstatic.com/image/thumb/Music126/v4/43/29/3c/43293c1a-83e1-43f7-4f4d-3b22a0956aeb/source/100x100bb.jpg';

  const artworkEl = document.getElementById('artwork');
  const titleEl = document.getElementById('title');
  const artistEl = document.getElementById('artist');
  const audioEl = document.getElementById('audio');
  const songListEl = document.getElementById('songList');

  let songs = [];
  let currentIndex = 0;

  // Convert Google Drive share URL to direct download URL
  function convertDriveUrlToDirect(url) {
    const regex = /\/d\/([a-zA-Z0-9_-]+)/;
    const match = url.match(regex);
    if (match && match[1]) {
      return `https://drive.google.com/uc?export=download&id=${match[1]}`;
    }
    return url;
  }

  function loadSong(index) {
    const song = songs[index];
    if (!song) return;

    titleEl.textContent = song.title || 'Unknown Title';
    artistEl.textContent = song.artist || 'Unknown Artist';
    artworkEl.src = song.artwork || FALLBACK_ARTWORK;

    audioEl.src = convertDriveUrlToDirect(song.url);
    audioEl.load();

    // Highlight active song
    [...songListEl.children].forEach((li, i) => {
      li.classList.toggle('active', i === index);
    });

    currentIndex = index;
  }

  function createSongList() {
    songs.forEach((song, index) => {
      const li = document.createElement('li');
      li.textContent = `${song.title} - ${song.artist}`;
      li.addEventListener('click', () => {
        loadSong(index);
        audioEl.play();
      });
      songListEl.appendChild(li);
    });
  }

  // Load songs JSON and initialize player
  fetch(JSON_URL)
    .then(res => res.json())
    .then(data => {
      // Expecting an array of {title, artist, url, artwork}
      songs = data;

      createSongList();
      loadSong(0);
    })
    .catch(() => {
      titleEl.textContent = 'Failed to load songs.';
    });

  // Prevent autoplay error: only play after user interaction
  document.body.addEventListener('click', () => {
    if (audioEl.paused && audioEl.src) {
      audioEl.play().catch(() => {
        // Ignore play errors if any
      });
    }
  }, { once: true });
</script>
</body>
</html>
